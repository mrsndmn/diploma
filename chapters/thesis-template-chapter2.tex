\chapter{Разработка моделей и алгоритмов}

% В этой главе описываются разработанные/модифицированные модели/методы/
% алгоритмы, или/и описывается применение известных стандартных методов. Также,
% в конце главы обычно приводится общая архитектура программной системы,
% вытекающая из описанной теории. Приведенные ниже заголовки подразделов так же
% весьма примерные и сильно зависят от особенностей конкретной работы.


\begin{annotation}
	В данной главе описываются алгоритмы работы нечетких когнитивных карт.
	Описывается модифицированная модель когнитивных карт с использованием
	рекуррентных нейросетей и сетей прямого распространения.
	Производится выбор метрик оценки качества работы системы.
\end{annotation}

\section{Описание алгоритма работы нечетких когнитивных карт}

Когнитивная карта – схема причинно-следственных связей в системе.
Когнитивная карта представляет из себя ориентированный граф.
Вершины этого графа – концепты, а ребра – причинно-следственные связи между соответствующими концептами.
Когнитивные карты строятся для того, чтобы понять и проанализировать структуру сложной системы.
Каждое ребро когнитивной карты имеет свой вес, который характеризует степень влияния одного концепта на другой.

Обычно при прогнозировании с использованием нечетких когнитивных карт существует один целевой концепт,
значение которого необходимо спрогнозировать.


Стандартная формула для пересчета значений концептов нечетких когнитивных карт представлена на
\ref{img:concepts_recalc}.

$ A_i(t) $ - значение концепта $A_i$ на шаге $t$.

$ p(x) $ - функция активации \ref{img:sigmiog_actiovation}. Параметр $m$ определяет, на сколько сигмоида будет похожа на пороговую функицю.

\def\figurename{Формула}
\begin{figure}[t]
	\centering
	$ A_j(t+1) = p( A_j(t) + \sum_{i = 1, i \neq j}^{n} w_{ij} A_i(t) ) $,
	\caption{Стандартная формула пересчета значений концептов}
	\label{img:concepts_recalc}
\end{figure}
\noindent

\begin{figure}[t]
	\centering
	$ p(x) = \frac {1} {1+ e^{-mx} } $,
	\caption{Сигмоидальная функция активации}
	\label{img:sigmiog_actiovation}
\end{figure}
\def\figurename{Рис.}

В зависимости от задачи и данных, с которыми работает эксперт могут использоваться и другие
функции активации.

После того, как эксперт построил карту, он может приступить к моделированию поведения
системы и изучением причинно-следственной связи. Таким образом, эксперт может посмотреть,
как изменение одного концепта может повлиять на поведение системы в целом.

Если значения концептов карты расходятся, эксперту нужно или попробовать изменить функцию
активации или изменить значения весов концептов. Возможно, карта несбалансированна из-за
того, что в ней отсутствует еще один компонент, который вносит значительный вклад в поведение системы.

Пересчет значений концептов проходит итеративно. Имея исторические данные эксперт может
подобрать значения весов таким образом, чтобы смоделированное поведение системы как можно меньше отличалось
от экспериментальных данных. В случае классических когнитивных карт эксперту нужно это делать вручную.

После того, как эксперт оптимизировал значения весов, можно приступить к изучению причинно-следственных
связей.

\section{Интеграция когнитивных карт и нейросетей для предсказания временных рядов}

Нейро-нечеткая система - это система, которая включает в себя методы нейронных сетей и методы нечеткой логики.

Поведение объекта в сложных системах прогнозировать непросто.
Часто необходимо знать не только результат прогноза,
но и причинно-следственные связи, которыми был обусловлен данный прогноз
\cite{osoba2019dags} \cite{efficient_fcms}.
Для выявления таких причинно-следственных связей используются нечеткие когнитивные карты.
Они позволяют качественно оценить влияние разных компонент системы на другие компоненты.
Однако, оригинальный алгоритм для пересчета значений концептов
не может описать сложные зависимости между отдельными компонентами.
Поэтому для того, чтобы увеличить мощность множества зависимостей, которые
может описать модель системы, можно использовать нейросетевые методы.
В таком случае когнитивная карта все еще хранит данные о причинно-следственных связях.

В нейросетевых подходах установить причинно-следственные связи сложнее.
Другие системы, например, деревья решений, наоборот, очень легко интерпретируются, легко обучаются,
но имеют более слабую способность к обобщению.

Идея нечетких когнитивных карт, предложенных Коско \cite{kosko1986fuzzy} имеет следующие преимущества:

\begin{itemize}
	\item Для проведения вычислений требуются небольшие вычислительные мощности.
	\item Простота в использовании.
	\item Можно легко добавлять и удалять концепты.
	\item Можно объединять готовые модели.
\end{itemize}

Однако есть и недостатки:

\begin{itemize}
	\item Веса линейные, нельзя описать сложную зависимость между концептами.
	\item Значение концепта зависит только от значений связанных концептов карты только на предыдущей итерации.
	Невозможно определить связанные во времени концепты больше, чем на одну итерацию.
	\item Веса карты должны быть оценены экспертно.
\end{itemize}

Эти недостатки можно считать существенными.
С этими недостатками можно бороться, если использовать модификации нечетких когнитивных карт,
например, TTR NFCM (Thee Term Relation Neural Fuzzy Cognotive Map) \cite{threeTermNfcm}.

В отличие от классических нечетких карт TTR NFCM позволяет
определять нелинейные функции для весов и при перерасчете значений концептов может учитывать то, как
этот концепт менялся во времени. Возможность использовать нелинейные веса достигается с помощью многослойных прецептронов.
А влияние предыдущих значений концептов определяется размером временного окна, за период которого проводится перерасчет
значений концептов.

\section{LSTM NFCM -~ Long Short-Serm Memory Neural Fuzzy Cognotive Map}

Можно усовершенствовать модель TTR LSTM, рассмотренную в предыдущем разделе,
если вместо сетей прямого распространения использовать рекуррентные сети,
например, LSTM \cite{LSTM_paper}. Такая сеть позволит более естественно
сохранять информацию об истории концептов в своем скрытом состоянии,
а для того, чтобы учитывать значения концептов на предыдущих итерациях
в сетях прямого распространения, каждый предыдущий шаг должен быть
описан как отдельная "фича", как отдельный параметр модели.

Сравнение LSTM NFCM с полносвязными сетями:
У LSTM NFCM меньше параметров по сравнению с сетью прямого распространения,
которая бы учитывала больше количество предыдущих значений во временном ряде.
LSTM NFCM дольше обучается, но имеет значительно лучшую способность к предсказанию
на длинных временных рядах.
Модель будет дольше обучаться, потому что нельзя распараллелить
процесс обучения LSTM сетей, так как в сети учитывается, что внутренее состояние меняется последовательно.
LSTM NFCM имеет лучшую интерпретируемость, так как содержит
экспертную информацию о взаимосвязи концептов.
Но для построения LSTM NFCM требуется эксперт, а как следствие,
ручная работа.

Сравнение LSTM NFCM с TTR NFCM:
LSTM NFCM дольше обучается, но на сложных данных
может иметь более точные прогнозы.

Сравнение LSTM NFCM с LSTM:
LSTM сеть, которая бы соответствовала LSTM NFCM, будет иметь
больше параметров в случае, если граф LSTM NFCM не слишком
много связей. LSTM NFCM лучше интерпретируема.
Скорость обучения, при условии оптимизаций в LSTM NFCM, с
помощью которых обучение LSTM моделей в каждой вершине бы проходило
параллельно, будет примерно одинаковой.
Предсказательная способность должна быть лучше у LSTM NFCM.
Потому что такая модель более проста и структурирована.
LSTM модель может оказаться излишне усложненной, так как в ней будет
большое количество параметров.
Но для построения LSTM NFCM требуется эксперт, а как следствие,
ручная работа.
Для построения LSTM NFCM требуется эксперт.


\section{Алгоритм обучения LSTM NFCM}

\section{Алгоритм вычисления LSTM NFCM}


\section{Выбор метрик для оценки качества работы алгоритмов}

\begin{annotation}
	В данном разделе производится выбор и описание метрик для оценки
	качества работы нейро-нечеткой системы. Описывается смысл приведенных метрик.
	Приводятся расчетные формулы для выбранных метрик.
\end{annotation}

% В качестве критерия качества результата работы системы можно взять
% аккумулированную квадратичную ошибку для каждого концепта на каждом шаге итерации.
% \ref{img:loss_func}

% Это значение можно считать для каждого концепта. Но для простоты интерпретации результатов,
% можно и сложить и изменить ошибку для всех концептов на определенном шаге итерации.

% \def\figurename{Формула}
% \begin{figure}[t]
% 	\centering
% 	$ Err(t) = \sum_{i = 0}^{n} ( y_i - \hat{y_i} )^{2} $,
% 	\caption{Критерий качества работы карты}
% 	\label{img:loss_func}
% \end{figure}
% \def\figurename{Рис.}



\section{Выводы}

В данной главе была рассмотрена модель когнитивных карт.
Была разработана модель когнитивных карт
с использованием нейросетей (рекуррентных и прямого распространения).
Были выбраны методы оценки качества работы разрабатываемой системы.